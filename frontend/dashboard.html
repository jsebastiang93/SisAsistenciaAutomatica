<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Consulta de Asistencia</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .scan-btn {
      background-color: #009688;
      color: white;
      padding: 10px 20px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      border-radius: 4px;
      margin-right: 10px;
    }
    .scan-btn:hover {
      background-color: #00796b;
    }
    .scan-btn.stop {
      background-color: #b71c1c;
    }
    .scan-btn.stop:hover {
      background-color: #8e0000;
    }
    #respuestaEscaneo {
      margin-top: 10px;
      font-weight: bold;
    }
    #modalConfirmacion {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #modalConfirmacion .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      max-width: 400px;
    }
    #codigoEscanerModal {
      padding: 10px;
      width: 90%;
      font-size: 16px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- Modal -->
  <div id="modalConfirmacion">
    <div class="modal-content">
      <p>Escanee el c√≥digo y confirme el env√≠o</p>
      <form onsubmit="event.preventDefault(); confirmarEnvioDesdeModal();">
        <input type="text" id="codigoEscanerModal" placeholder="Escanea aqu√≠..." autocomplete="off" />
        <div style="margin-top: 20px;">
          <button type="submit" class="scan-btn">Aceptar</button>
          <button type="button" onclick="cerrarModal()" class="scan-btn stop">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Encabezado -->
  <header class="header-banner">
    <div class="banner">
      <img src="icono-asistencia.png" alt="√çcono asistencia" class="icono-banner" />
      <span class="titulo-banner">Sistema de asistencia autom√°tica</span>
      <div class="user-info">
        <p>Nazly Roc√≠o<br><span>Periodo 2025-1</span></p>
        <a href="index.html" class="logout-btn">‚§¥</a>
      </div>
    </div>
  </header>

  <!-- Contenido principal -->
  <div class="dashboard">
    <nav class="sidebar">
      <h3>Men√∫</h3>
      <ul>
        <li><strong>Consulta de asistencia</strong></li>
      </ul>
      <h3>Configuraci√≥n</h3>
      <ul>
        <li>Periodos acad√©micos</li>
        <li>Programas acad√©micos</li>
        <li>Excusas por inasistencia</li>
        <li>Estudiantes</li>
        <li>Docentes</li>
      </ul>
    </nav>

    <main class="content">
      <h2>Consulta de asistencia a clases</h2>

      <!-- Bot√≥n de esc√°ner -->
      <div style="margin-top: 20px;">
        <button onclick="mostrarModalConfirmacion()" class="scan-btn">üü¢ Escanear documento</button>
        <p id="respuestaEscaneo"></p>
      </div>

      <!-- Filtros -->
      <div class="filters">
        <label>Per√≠odo acad√©mico
          <select><option>2025-1 Primer semestre</option></select>
        </label>
        <label>Asignatura
          <select><option>Electiva de Profundizaci√≥n III</option></select>
        </label>
        <label>Fecha de clase
          <input type="date" value="2025-04-29" />
        </label>
        <button class="search-btn">üîç</button>
      </div>

      <div class="stats">
        <div class="stat yellow"><strong>13</strong><br>Estudiantes Matriculados</div>
        <div class="stat green"><strong>8</strong><br>Asistencias</div>
        <div class="stat red"><strong>5</strong><br>Inasistencias</div>
        <div class="stat blue"><strong>0</strong><br>Excusas por inasistencia</div>
      </div>

      <div class="class-info">
        <p><strong>Docente:</strong> Nazly Roc√≠o Hincapi√© Monsalve</p>
        <p><strong>D√≠a de semana de clase:</strong> Martes</p>
        <p><strong>Horario de la clase:</strong> 06:30 pm - 09:30 pm</p>
      </div>

      <table>
        <thead>
          <tr>
            <th>Nombre del Estudiante</th>
            <th>Hora de registro</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>397507 Wilson David Menza Pavi</td>
            <td>06:35 pm - Asisti√≥</td>
            <td><a href="#">Adicionar excusa</a></td>
          </tr>
        </tbody>
      </table>
    </main>
  </div>

  <footer>
    <p>Copyright ¬© 2025 - Unicat√≥lica | Versi√≥n 0.0.1</p>
  </footer>

  <!-- Script -->
  <script>
  
  function confirmarEnvioDesdeModal() {
    const codigo = document.getElementById("codigoEscanerModal").value.trim();

    if (codigo === "") {
      alert("‚ö†Ô∏è Por favor escanee o ingrese un c√≥digo.");
      return;
    }

    fetch("http://localhost:8000/iniciar-escaner", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ codigo }) // Enviando como JSON
    })
      .then(response => response.json())
      .then(data => {
        document.getElementById("respuestaEscaneo").innerText =
          data.mensaje || data.error || "Respuesta inesperada.";
      })
      .catch(error => {
        document.getElementById("respuestaEscaneo").innerText =
          "‚ùå Error al conectar con el servidor.";
        console.error("Error:", error);
      });

    cerrarModal(); // Asumiendo que esto cierra tu modal
  }


    function mostrarModalConfirmacion() {
      document.getElementById("modalConfirmacion").style.display = "flex";
      const input = document.getElementById("codigoEscanerModal");
      input.value = "";
      input.focus();
    }

    function cerrarModal() {
      document.getElementById("modalConfirmacion").style.display = "none";
      document.getElementById("codigoEscanerModal").value = "";
    }
    // ‚ö†Ô∏è Prevenir Enter global para que no recargue la p√°gina
    document.addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        const modal = document.getElementById("modalConfirmacion");
        const input = document.getElementById("codigoEscanerModal");
        if (modal.style.display === "flex" && document.activeElement !== input) {
          event.preventDefault();
        }
        // Tambi√©n prevenimos por seguridad en cualquier parte
        if (modal.style.display !== "flex") {
          event.preventDefault();
        }
      }
    });
  </script>
</body>
</html>
